{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _FactoryMaker = require('../../../core/FactoryMaker');\n\nvar _FactoryMaker2 = _interopRequireDefault(_FactoryMaker);\n\nvar _SwitchRequest = require('../SwitchRequest');\n\nvar _SwitchRequest2 = _interopRequireDefault(_SwitchRequest);\n\nvar _Debug = require('../../../core/Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction DroppedFramesRule() {\n  var context = this.context;\n  var instance = void 0,\n      logger = void 0;\n  var DROPPED_PERCENTAGE_FORBID = 0.15;\n  var GOOD_SAMPLE_SIZE = 375; //Don't apply the rule until this many frames have been rendered(and counted under those indices).\n\n  function setup() {\n    logger = (0, _Debug2.default)(context).getInstance().getLogger(instance);\n  }\n\n  function getMaxIndex(rulesContext) {\n    var switchRequest = (0, _SwitchRequest2.default)(context).create();\n\n    if (!rulesContext || !rulesContext.hasOwnProperty('getDroppedFramesHistory')) {\n      return switchRequest;\n    }\n\n    var droppedFramesHistory = rulesContext.getDroppedFramesHistory();\n\n    if (droppedFramesHistory) {\n      var dfh = droppedFramesHistory.getFrameHistory();\n      var droppedFrames = 0;\n      var totalFrames = 0;\n      var maxIndex = _SwitchRequest2.default.NO_CHANGE;\n\n      for (var i = 1; i < dfh.length; i++) {\n        //No point in measuring dropped frames for the zeroeth index.\n        if (dfh[i]) {\n          droppedFrames = dfh[i].droppedVideoFrames;\n          totalFrames = dfh[i].totalVideoFrames;\n\n          if (totalFrames > GOOD_SAMPLE_SIZE && droppedFrames / totalFrames > DROPPED_PERCENTAGE_FORBID) {\n            maxIndex = i - 1;\n            logger.debug('index: ' + maxIndex + ' Dropped Frames: ' + droppedFrames + ' Total Frames: ' + totalFrames);\n            break;\n          }\n        }\n      }\n\n      return (0, _SwitchRequest2.default)(context).create(maxIndex, {\n        droppedFrames: droppedFrames\n      });\n    }\n\n    return switchRequest;\n  }\n\n  instance = {\n    getMaxIndex: getMaxIndex\n  };\n  setup();\n  return instance;\n}\n\nDroppedFramesRule.__dashjs_factory_name = 'DroppedFramesRule';\nexports.default = _FactoryMaker2.default.getClassFactory(DroppedFramesRule);","map":{"version":3,"mappings":";;;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA;;AAAA,SAASA,iBAAT,GAA6B;EAEzB,IAAMC,UAAU,KAAKA,OAArB;EACA,IAAIC,iBAAJ;EAAA,IACIC,eADJ;EAGA,IAAMC,4BAA4B,IAAlC;EACA,IAAMC,mBAAmB,GAAzB,CAPyB,CAOK;;EAE9B,SAASC,KAAT,GAAiB;IACbH,SAAS,qBAAMF,OAAN,EAAeM,WAAf,GAA6BC,SAA7B,CAAuCN,QAAvC,CAATC;EAGJ;;EAAA,SAASM,WAAT,CAAqBC,YAArB,EAAmC;IAC/B,IAAMC,gBAAgB,6BAAcV,OAAd,EAAuBW,MAAvB,EAAtB;;IAEA,IAAI,CAACF,YAAD,IAAiB,CAACA,aAAaG,cAAbH,CAA4B,yBAA5BA,CAAtB,EAA8E;MAC1E,OAAOC,aAAP;IAEJ;;IAAA,IAAMG,uBAAuBJ,aAAaK,uBAAbL,EAA7B;;IACA,IAAII,oBAAJ,EAA0B;MACtB,IAAME,MAAMF,qBAAqBG,eAArBH,EAAZ;MACA,IAAII,gBAAgB,CAApB;MACA,IAAIC,cAAc,CAAlB;MACA,IAAIC,WAAWC,wBAAcC,SAA7B;;MACA,KAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIP,IAAIQ,MAAxB,EAAgCD,GAAhC,EAAqC;QAAE;QACnC,IAAIP,IAAIO,CAAJP,CAAJ,EAAY;UACRE,gBAAgBF,IAAIO,CAAJP,EAAOS,kBAAvBP;UACAC,cAAcH,IAAIO,CAAJP,EAAOU,gBAArBP;;UAEA,IAAIA,cAAcd,gBAAdc,IAAkCD,gBAAgBC,WAAhBD,GAA8Bd,yBAApE,EAA+F;YAC3FgB,WAAWG,IAAI,CAAfH;YACAjB,OAAOwB,KAAPxB,CAAa,YAAYiB,QAAZ,GAAuB,mBAAvB,GAA6CF,aAA7C,GAA6D,iBAA7D,GAAiFC,WAA9FhB;YACA;UAEP;QACJ;MACD;;MAAA,OAAO,6BAAcF,OAAd,EAAuBW,MAAvB,CAA8BQ,QAA9B,EAAwC;QAACF,eAAeA;MAAhB,CAAxC,CAAP;IAGJ;;IAAA,OAAOP,aAAP;EAGJT;;EAAAA,WAAW;IACPO,aAAaA;EADN,CAAXP;EAIAI;EAEA,OAAOJ,QAAP;AAGJF;;AAAAA,kBAAkB4B,qBAAlB5B,GAA0C,mBAA1CA;kBACe6B,uBAAaC,eAAbD,CAA6B7B,iBAA7B6B,C","names":["DroppedFramesRule","context","instance","logger","DROPPED_PERCENTAGE_FORBID","GOOD_SAMPLE_SIZE","setup","getInstance","getLogger","getMaxIndex","rulesContext","switchRequest","create","hasOwnProperty","droppedFramesHistory","getDroppedFramesHistory","dfh","getFrameHistory","droppedFrames","totalFrames","maxIndex","SwitchRequest","NO_CHANGE","i","length","droppedVideoFrames","totalVideoFrames","debug","__dashjs_factory_name","FactoryMaker","getClassFactory"],"sources":["/home/landsys/react-node-video-streaming/client/node_modules/dashjs/src/streaming/rules/abr/DroppedFramesRule.js"],"sourcesContent":["\nimport FactoryMaker from '../../../core/FactoryMaker';\nimport SwitchRequest from '../SwitchRequest';\nimport Debug from '../../../core/Debug';\n\nfunction DroppedFramesRule() {\n\n    const context = this.context;\n    let instance,\n        logger;\n\n    const DROPPED_PERCENTAGE_FORBID = 0.15;\n    const GOOD_SAMPLE_SIZE = 375; //Don't apply the rule until this many frames have been rendered(and counted under those indices).\n\n    function setup() {\n        logger = Debug(context).getInstance().getLogger(instance);\n    }\n\n    function getMaxIndex(rulesContext) {\n        const switchRequest = SwitchRequest(context).create();\n\n        if (!rulesContext || !rulesContext.hasOwnProperty('getDroppedFramesHistory')) {\n            return switchRequest;\n        }\n        const droppedFramesHistory = rulesContext.getDroppedFramesHistory();\n        if (droppedFramesHistory) {\n            const dfh = droppedFramesHistory.getFrameHistory();\n            let droppedFrames = 0;\n            let totalFrames = 0;\n            let maxIndex = SwitchRequest.NO_CHANGE;\n            for (let i = 1; i < dfh.length; i++) { //No point in measuring dropped frames for the zeroeth index.\n                if (dfh[i]) {\n                    droppedFrames = dfh[i].droppedVideoFrames;\n                    totalFrames = dfh[i].totalVideoFrames;\n\n                    if (totalFrames > GOOD_SAMPLE_SIZE && droppedFrames / totalFrames > DROPPED_PERCENTAGE_FORBID) {\n                        maxIndex = i - 1;\n                        logger.debug('index: ' + maxIndex + ' Dropped Frames: ' + droppedFrames + ' Total Frames: ' + totalFrames);\n                        break;\n                    }\n                }\n            }\n            return SwitchRequest(context).create(maxIndex, {droppedFrames: droppedFrames});\n        }\n\n        return switchRequest;\n    }\n\n    instance = {\n        getMaxIndex: getMaxIndex\n    };\n\n    setup();\n\n    return instance;\n}\n\nDroppedFramesRule.__dashjs_factory_name = 'DroppedFramesRule';\nexport default FactoryMaker.getClassFactory(DroppedFramesRule);"]},"metadata":{},"sourceType":"script"}