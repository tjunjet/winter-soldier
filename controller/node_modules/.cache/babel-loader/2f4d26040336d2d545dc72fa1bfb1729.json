{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _Constants = require('../constants/Constants');\n\nvar _Constants2 = _interopRequireDefault(_Constants);\n\nvar _EventBus = require('../../core/EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nvar _Events = require('../../core/events/Events');\n\nvar _Events2 = _interopRequireDefault(_Events);\n\nvar _FactoryMaker = require('../../core/FactoryMaker');\n\nvar _FactoryMaker2 = _interopRequireDefault(_FactoryMaker);\n\nvar _Debug = require('../../core/Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _imsc = require('imsc');\n\nvar _SupervisorTools = require('../utils/SupervisorTools');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction TextTracks() {\n  var context = this.context;\n  var eventBus = (0, _EventBus2.default)(context).getInstance();\n  var instance = void 0,\n      logger = void 0,\n      Cue = void 0,\n      videoModel = void 0,\n      textTrackQueue = void 0,\n      trackElementArr = void 0,\n      currentTrackIdx = void 0,\n      actualVideoLeft = void 0,\n      actualVideoTop = void 0,\n      actualVideoWidth = void 0,\n      actualVideoHeight = void 0,\n      captionContainer = void 0,\n      videoSizeCheckInterval = void 0,\n      fullscreenAttribute = void 0,\n      displayCCOnTop = void 0,\n      previousISDState = void 0,\n      topZIndex = void 0,\n      resizeObserver = void 0;\n\n  function setup() {\n    logger = (0, _Debug2.default)(context).getInstance().getLogger(instance);\n  }\n\n  function initialize() {\n    if (typeof window === 'undefined' || typeof navigator === 'undefined') {\n      return;\n    }\n\n    Cue = window.VTTCue || window.TextTrackCue;\n    textTrackQueue = [];\n    trackElementArr = [];\n    currentTrackIdx = -1;\n    actualVideoLeft = 0;\n    actualVideoTop = 0;\n    actualVideoWidth = 0;\n    actualVideoHeight = 0;\n    captionContainer = null;\n    videoSizeCheckInterval = null;\n    displayCCOnTop = false;\n    topZIndex = 2147483647;\n    previousISDState = null;\n\n    if (document.fullscreenElement !== undefined) {\n      fullscreenAttribute = 'fullscreenElement'; // Standard and Edge\n    } else if (document.webkitIsFullScreen !== undefined) {\n      fullscreenAttribute = 'webkitIsFullScreen'; // Chrome and Safari (and Edge)\n    } else if (document.msFullscreenElement) {\n      // IE11\n      fullscreenAttribute = 'msFullscreenElement';\n    } else if (document.mozFullScreen) {\n      // Firefox\n      fullscreenAttribute = 'mozFullScreen';\n    }\n  }\n\n  function createTrackForUserAgent(i) {\n    var kind = textTrackQueue[i].kind;\n    var label = textTrackQueue[i].id !== undefined ? textTrackQueue[i].id : textTrackQueue[i].lang;\n    var lang = textTrackQueue[i].lang;\n    var isTTML = textTrackQueue[i].isTTML;\n    var isEmbedded = textTrackQueue[i].isEmbedded;\n    var track = videoModel.addTextTrack(kind, label, lang, isTTML, isEmbedded);\n    return track;\n  }\n\n  function setDisplayCConTop(value) {\n    (0, _SupervisorTools.checkParameterType)(value, 'boolean');\n    displayCCOnTop = value;\n\n    if (!captionContainer || document[fullscreenAttribute]) {\n      return;\n    }\n\n    captionContainer.style.zIndex = value ? topZIndex : null;\n  }\n\n  function addTextTrack(textTrackInfoVO, totalTextTracks) {\n    if (textTrackQueue.length === totalTextTracks) {\n      logger.error('Trying to add too many tracks.');\n      return;\n    }\n\n    textTrackQueue.push(textTrackInfoVO);\n\n    if (textTrackQueue.length === totalTextTracks) {\n      textTrackQueue.sort(function (a, b) {\n        //Sort in same order as in manifest\n        return a.index - b.index;\n      });\n      captionContainer = videoModel.getTTMLRenderingDiv();\n      var defaultIndex = -1;\n\n      for (var i = 0; i < textTrackQueue.length; i++) {\n        var track = createTrackForUserAgent.call(this, i);\n        trackElementArr.push(track); //used to remove tracks from video element when added manually\n\n        if (textTrackQueue[i].defaultTrack) {\n          // track.default is an object property identifier that is a reserved word\n          // The following jshint directive is used to suppressed the warning \"Expected an identifier and instead saw 'default' (a reserved word)\"\n\n          /*jshint -W024 */\n          track.default = true;\n          defaultIndex = i;\n        }\n\n        var textTrack = getTrackByIdx(i);\n\n        if (textTrack) {\n          //each time a track is created, its mode should be showing by default\n          //sometime, it's not on Chrome\n          textTrack.mode = _Constants2.default.TEXT_SHOWING;\n\n          if (captionContainer && (textTrackQueue[i].isTTML || textTrackQueue[i].isEmbedded)) {\n            textTrack.renderingType = 'html';\n          } else {\n            textTrack.renderingType = 'default';\n          }\n        }\n\n        this.addCaptions(i, 0, textTrackQueue[i].captionData);\n        eventBus.trigger(_Events2.default.TEXT_TRACK_ADDED);\n      } //set current track index in textTrackQueue array\n\n\n      setCurrentTrackIdx.call(this, defaultIndex);\n\n      if (defaultIndex >= 0) {\n        var onMetadataLoaded = function onMetadataLoaded() {\n          var track = getTrackByIdx(defaultIndex);\n\n          if (track) {\n            checkVideoSize.call(this, track, true);\n          }\n\n          eventBus.off(_Events2.default.PLAYBACK_METADATA_LOADED, onMetadataLoaded, this);\n        };\n\n        eventBus.on(_Events2.default.PLAYBACK_METADATA_LOADED, onMetadataLoaded, this);\n\n        for (var idx = 0; idx < textTrackQueue.length; idx++) {\n          var videoTextTrack = getTrackByIdx(idx);\n\n          if (videoTextTrack) {\n            videoTextTrack.mode = idx === defaultIndex ? _Constants2.default.TEXT_SHOWING : _Constants2.default.TEXT_HIDDEN;\n          }\n        }\n      }\n\n      eventBus.trigger(_Events2.default.TEXT_TRACKS_QUEUE_INITIALIZED, {\n        index: currentTrackIdx,\n        tracks: textTrackQueue\n      }); //send default idx.\n    }\n  }\n\n  function getVideoVisibleVideoSize(viewWidth, viewHeight, videoWidth, videoHeight, aspectRatio, use80Percent) {\n    var viewAspectRatio = viewWidth / viewHeight;\n    var videoAspectRatio = videoWidth / videoHeight;\n    var videoPictureWidth = 0;\n    var videoPictureHeight = 0;\n\n    if (viewAspectRatio > videoAspectRatio) {\n      videoPictureHeight = viewHeight;\n      videoPictureWidth = videoPictureHeight / videoHeight * videoWidth;\n    } else {\n      videoPictureWidth = viewWidth;\n      videoPictureHeight = videoPictureWidth / videoWidth * videoHeight;\n    }\n\n    var videoPictureXAspect = 0;\n    var videoPictureYAspect = 0;\n    var videoPictureWidthAspect = 0;\n    var videoPictureHeightAspect = 0;\n    var videoPictureAspect = videoPictureWidth / videoPictureHeight;\n\n    if (videoPictureAspect > aspectRatio) {\n      videoPictureHeightAspect = videoPictureHeight;\n      videoPictureWidthAspect = videoPictureHeight * aspectRatio;\n    } else {\n      videoPictureWidthAspect = videoPictureWidth;\n      videoPictureHeightAspect = videoPictureWidth / aspectRatio;\n    }\n\n    videoPictureXAspect = (viewWidth - videoPictureWidthAspect) / 2;\n    videoPictureYAspect = (viewHeight - videoPictureHeightAspect) / 2;\n\n    if (use80Percent) {\n      return {\n        x: videoPictureXAspect + videoPictureWidthAspect * 0.1,\n        y: videoPictureYAspect + videoPictureHeightAspect * 0.1,\n        w: videoPictureWidthAspect * 0.8,\n        h: videoPictureHeightAspect * 0.8\n      };\n      /* Maximal picture size in videos aspect ratio */\n    } else {\n      return {\n        x: videoPictureXAspect,\n        y: videoPictureYAspect,\n        w: videoPictureWidthAspect,\n        h: videoPictureHeightAspect\n      };\n      /* Maximal picture size in videos aspect ratio */\n    }\n  }\n\n  function checkVideoSize(track, forceDrawing) {\n    var clientWidth = videoModel.getClientWidth();\n    var clientHeight = videoModel.getClientHeight();\n    var videoWidth = videoModel.getVideoWidth();\n    var videoHeight = videoModel.getVideoHeight();\n    var videoOffsetTop = videoModel.getVideoRelativeOffsetTop();\n    var videoOffsetLeft = videoModel.getVideoRelativeOffsetLeft();\n\n    if (videoWidth !== 0 && videoHeight !== 0) {\n      var aspectRatio = videoWidth / videoHeight;\n      var use80Percent = false;\n\n      if (track.isFromCEA608) {\n        // If this is CEA608 then use predefined aspect ratio\n        aspectRatio = 3.5 / 3.0;\n        use80Percent = true;\n      }\n\n      var realVideoSize = getVideoVisibleVideoSize.call(this, clientWidth, clientHeight, videoWidth, videoHeight, aspectRatio, use80Percent);\n      var newVideoWidth = realVideoSize.w;\n      var newVideoHeight = realVideoSize.h;\n      var newVideoLeft = realVideoSize.x;\n      var newVideoTop = realVideoSize.y;\n\n      if (newVideoWidth != actualVideoWidth || newVideoHeight != actualVideoHeight || newVideoLeft != actualVideoLeft || newVideoTop != actualVideoTop || forceDrawing) {\n        actualVideoLeft = newVideoLeft + videoOffsetLeft;\n        actualVideoTop = newVideoTop + videoOffsetTop;\n        actualVideoWidth = newVideoWidth;\n        actualVideoHeight = newVideoHeight;\n\n        if (captionContainer) {\n          var containerStyle = captionContainer.style;\n\n          if (containerStyle) {\n            containerStyle.left = actualVideoLeft + 'px';\n            containerStyle.top = actualVideoTop + 'px';\n            containerStyle.width = actualVideoWidth + 'px';\n            containerStyle.height = actualVideoHeight + 'px';\n            containerStyle.zIndex = fullscreenAttribute && document[fullscreenAttribute] || displayCCOnTop ? topZIndex : null;\n            eventBus.trigger(_Events2.default.CAPTION_CONTAINER_RESIZE);\n          }\n        } // Video view has changed size, so resize any active cues\n\n\n        var activeCues = track.activeCues;\n\n        if (activeCues) {\n          var len = activeCues.length;\n\n          for (var i = 0; i < len; ++i) {\n            var cue = activeCues[i];\n            cue.scaleCue(cue);\n          }\n        }\n      }\n    }\n  }\n\n  function scaleCue(activeCue) {\n    var videoWidth = actualVideoWidth;\n    var videoHeight = actualVideoHeight;\n    var key = void 0,\n        replaceValue = void 0,\n        valueFontSize = void 0,\n        valueLineHeight = void 0,\n        elements = void 0;\n\n    if (activeCue.cellResolution) {\n      var cellUnit = [videoWidth / activeCue.cellResolution[0], videoHeight / activeCue.cellResolution[1]];\n\n      if (activeCue.linePadding) {\n        for (key in activeCue.linePadding) {\n          if (activeCue.linePadding.hasOwnProperty(key)) {\n            var valueLinePadding = activeCue.linePadding[key];\n            replaceValue = (valueLinePadding * cellUnit[0]).toString(); // Compute the CellResolution unit in order to process properties using sizing (fontSize, linePadding, etc).\n\n            var elementsSpan = document.getElementsByClassName('spanPadding');\n\n            for (var i = 0; i < elementsSpan.length; i++) {\n              elementsSpan[i].style.cssText = elementsSpan[i].style.cssText.replace(/(padding-left\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n              elementsSpan[i].style.cssText = elementsSpan[i].style.cssText.replace(/(padding-right\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n            }\n          }\n        }\n      }\n\n      if (activeCue.fontSize) {\n        for (key in activeCue.fontSize) {\n          if (activeCue.fontSize.hasOwnProperty(key)) {\n            if (activeCue.fontSize[key][0] === '%') {\n              valueFontSize = activeCue.fontSize[key][1] / 100;\n            } else if (activeCue.fontSize[key][0] === 'c') {\n              valueFontSize = activeCue.fontSize[key][1];\n            }\n\n            replaceValue = (valueFontSize * cellUnit[1]).toString();\n\n            if (key !== 'defaultFontSize') {\n              elements = document.getElementsByClassName(key);\n            } else {\n              elements = document.getElementsByClassName('paragraph');\n            }\n\n            for (var j = 0; j < elements.length; j++) {\n              elements[j].style.cssText = elements[j].style.cssText.replace(/(font-size\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n            }\n          }\n        }\n\n        if (activeCue.lineHeight) {\n          for (key in activeCue.lineHeight) {\n            if (activeCue.lineHeight.hasOwnProperty(key)) {\n              if (activeCue.lineHeight[key][0] === '%') {\n                valueLineHeight = activeCue.lineHeight[key][1] / 100;\n              } else if (activeCue.fontSize[key][0] === 'c') {\n                valueLineHeight = activeCue.lineHeight[key][1];\n              }\n\n              replaceValue = (valueLineHeight * cellUnit[1]).toString();\n              elements = document.getElementsByClassName(key);\n\n              for (var k = 0; k < elements.length; k++) {\n                elements[k].style.cssText = elements[k].style.cssText.replace(/(line-height\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n              }\n            }\n          }\n        }\n      }\n    }\n\n    if (activeCue.isd) {\n      var htmlCaptionDiv = document.getElementById(activeCue.cueID);\n\n      if (htmlCaptionDiv) {\n        captionContainer.removeChild(htmlCaptionDiv);\n      }\n\n      renderCaption(activeCue);\n    }\n  }\n\n  function renderCaption(cue) {\n    if (captionContainer) {\n      var finalCue = document.createElement('div');\n      captionContainer.appendChild(finalCue);\n      previousISDState = (0, _imsc.renderHTML)(cue.isd, finalCue, function (uri) {\n        var imsc1ImgUrnTester = /^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/;\n        var smpteImgUrnTester = /^#(.*)$/;\n\n        if (imsc1ImgUrnTester.test(uri)) {\n          var match = imsc1ImgUrnTester.exec(uri);\n          var imageId = parseInt(match[4], 10) - 1;\n          var imageData = btoa(cue.images[imageId]);\n          var dataUrl = 'data:image/png;base64,' + imageData;\n          return dataUrl;\n        } else if (smpteImgUrnTester.test(uri)) {\n          var _match = smpteImgUrnTester.exec(uri);\n\n          var _imageId = _match[1];\n\n          var _dataUrl = 'data:image/png;base64,' + cue.embeddedImages[_imageId];\n\n          return _dataUrl;\n        } else {\n          return null;\n        }\n      }, captionContainer.clientHeight, captionContainer.clientWidth, false\n      /*displayForcedOnlyMode*/\n      , function (err) {\n        logger.info('renderCaption :', err); //TODO add ErrorHandler management\n      }, previousISDState, true\n      /*enableRollUp*/\n      );\n      finalCue.id = cue.cueID;\n      eventBus.trigger(_Events2.default.CAPTION_RENDERED, {\n        captionDiv: finalCue,\n        currentTrackIdx: currentTrackIdx\n      });\n    }\n  }\n  /*\n  * Add captions to track, store for later adding, or add captions added before\n  */\n\n\n  function addCaptions(trackIdx, timeOffset, captionData) {\n    var track = getTrackByIdx(trackIdx);\n    var self = this;\n\n    if (!track) {\n      return;\n    }\n\n    if (!Array.isArray(captionData) || captionData.length === 0) {\n      return;\n    }\n\n    for (var item = 0; item < captionData.length; item++) {\n      var cue = void 0;\n      var currentItem = captionData[item];\n      track.cellResolution = currentItem.cellResolution;\n      track.isFromCEA608 = currentItem.isFromCEA608;\n\n      if (currentItem.type === 'html' && captionContainer) {\n        cue = new Cue(currentItem.start - timeOffset, currentItem.end - timeOffset, '');\n        cue.cueHTMLElement = currentItem.cueHTMLElement;\n        cue.isd = currentItem.isd;\n        cue.images = currentItem.images;\n        cue.embeddedImages = currentItem.embeddedImages;\n        cue.cueID = currentItem.cueID;\n        cue.scaleCue = scaleCue.bind(self); //useful parameters for cea608 subtitles, not for TTML one.\n\n        cue.cellResolution = currentItem.cellResolution;\n        cue.lineHeight = currentItem.lineHeight;\n        cue.linePadding = currentItem.linePadding;\n        cue.fontSize = currentItem.fontSize;\n        captionContainer.style.left = actualVideoLeft + 'px';\n        captionContainer.style.top = actualVideoTop + 'px';\n        captionContainer.style.width = actualVideoWidth + 'px';\n        captionContainer.style.height = actualVideoHeight + 'px';\n\n        cue.onenter = function () {\n          if (track.mode === _Constants2.default.TEXT_SHOWING) {\n            if (this.isd) {\n              renderCaption(this);\n              logger.debug('Cue enter id:' + this.cueID);\n            } else {\n              captionContainer.appendChild(this.cueHTMLElement);\n              scaleCue.call(self, this);\n              eventBus.trigger(_Events2.default.CAPTION_RENDERED, {\n                captionDiv: this.cueHTMLElement,\n                currentTrackIdx: currentTrackIdx\n              });\n            }\n          }\n        };\n\n        cue.onexit = function () {\n          if (captionContainer) {\n            var divs = captionContainer.childNodes;\n\n            for (var i = 0; i < divs.length; ++i) {\n              if (divs[i].id === this.cueID) {\n                logger.debug('Cue exit id:' + divs[i].id);\n                captionContainer.removeChild(divs[i]);\n                --i;\n              }\n            }\n          }\n        };\n      } else {\n        if (currentItem.data) {\n          cue = new Cue(currentItem.start - timeOffset, currentItem.end - timeOffset, currentItem.data);\n\n          if (currentItem.styles) {\n            if (currentItem.styles.align !== undefined && 'align' in cue) {\n              cue.align = currentItem.styles.align;\n            }\n\n            if (currentItem.styles.line !== undefined && 'line' in cue) {\n              cue.line = currentItem.styles.line;\n            }\n\n            if (currentItem.styles.position !== undefined && 'position' in cue) {\n              cue.position = currentItem.styles.position;\n            }\n\n            if (currentItem.styles.size !== undefined && 'size' in cue) {\n              cue.size = currentItem.styles.size;\n            }\n          }\n\n          cue.onenter = function () {\n            if (track.mode === _Constants2.default.TEXT_SHOWING) {\n              eventBus.trigger(_Events2.default.CAPTION_RENDERED, {\n                currentTrackIdx: currentTrackIdx\n              });\n            }\n          };\n        }\n      }\n\n      try {\n        if (cue) {\n          track.addCue(cue);\n        } else {\n          logger.error('impossible to display subtitles.');\n        }\n      } catch (e) {\n        // Edge crash, delete everything and start adding again\n        // @see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11979877/\n        deleteTrackCues(track);\n        track.addCue(cue);\n        throw e;\n      }\n    }\n  }\n\n  function getTrackByIdx(idx) {\n    return idx >= 0 && textTrackQueue[idx] ? videoModel.getTextTrack(textTrackQueue[idx].kind, textTrackQueue[idx].id, textTrackQueue[idx].lang, textTrackQueue[idx].isTTML, textTrackQueue[idx].isEmbedded) : null;\n  }\n\n  function getCurrentTrackIdx() {\n    return currentTrackIdx;\n  }\n\n  function getTrackIdxForId(trackId) {\n    var idx = -1;\n\n    for (var i = 0; i < textTrackQueue.length; i++) {\n      if (textTrackQueue[i].id === trackId) {\n        idx = i;\n        break;\n      }\n    }\n\n    return idx;\n  }\n\n  function setCurrentTrackIdx(idx) {\n    var _this = this;\n\n    if (idx === currentTrackIdx) {\n      return;\n    }\n\n    currentTrackIdx = idx;\n    var track = getTrackByIdx(currentTrackIdx);\n    setCueStyleOnTrack.call(this, track);\n\n    if (videoSizeCheckInterval) {\n      clearInterval(videoSizeCheckInterval);\n      videoSizeCheckInterval = null;\n    }\n\n    if (track && track.renderingType === 'html') {\n      checkVideoSize.call(this, track, true);\n\n      if (window.ResizeObserver) {\n        resizeObserver = new window.ResizeObserver(function () {\n          checkVideoSize.call(_this, track, true);\n        });\n        resizeObserver.observe(videoModel.getElement());\n      } else {\n        videoSizeCheckInterval = setInterval(checkVideoSize.bind(this, track), 500);\n      }\n    }\n  }\n\n  function setCueStyleOnTrack(track) {\n    clearCaptionContainer.call(this);\n\n    if (track) {\n      if (track.renderingType === 'html') {\n        setNativeCueStyle.call(this);\n      } else {\n        removeNativeCueStyle.call(this);\n      }\n    } else {\n      removeNativeCueStyle.call(this);\n    }\n  }\n\n  function cueInRange(cue, start, end) {\n    return (isNaN(start) || cue.startTime >= start) && (isNaN(end) || cue.endTime <= end);\n  }\n\n  function deleteTrackCues(track, start, end) {\n    if (track.cues) {\n      var cues = track.cues;\n      var lastIdx = cues.length - 1;\n\n      for (var r = lastIdx; r >= 0; r--) {\n        if (cueInRange(cues[r], start, end)) {\n          track.removeCue(cues[r]);\n        }\n      }\n    }\n  }\n\n  function deleteCuesFromTrackIdx(trackIdx, start, end) {\n    var track = getTrackByIdx(trackIdx);\n\n    if (track) {\n      deleteTrackCues(track, start, end);\n    }\n  }\n\n  function deleteAllTextTracks() {\n    var ln = trackElementArr ? trackElementArr.length : 0;\n\n    for (var i = 0; i < ln; i++) {\n      var track = getTrackByIdx(i);\n\n      if (track) {\n        deleteTrackCues.call(this, track);\n        track.mode = 'disabled';\n      }\n    }\n\n    trackElementArr = [];\n    textTrackQueue = [];\n\n    if (videoSizeCheckInterval) {\n      clearInterval(videoSizeCheckInterval);\n      videoSizeCheckInterval = null;\n    }\n\n    if (resizeObserver && videoModel) {\n      resizeObserver.unobserve(videoModel.getElement());\n      resizeObserver = null;\n    }\n\n    currentTrackIdx = -1;\n    clearCaptionContainer.call(this);\n  }\n\n  function deleteTextTrack(idx) {\n    videoModel.removeChild(trackElementArr[idx]);\n    trackElementArr.splice(idx, 1);\n  }\n  /* Set native cue style to transparent background to avoid it being displayed. */\n\n\n  function setNativeCueStyle() {\n    var styleElement = document.getElementById('native-cue-style');\n\n    if (styleElement) {\n      return; //Already set\n    }\n\n    styleElement = document.createElement('style');\n    styleElement.id = 'native-cue-style';\n    document.head.appendChild(styleElement);\n    var stylesheet = styleElement.sheet;\n    var video = videoModel.getElement();\n\n    try {\n      if (video) {\n        if (video.id) {\n          stylesheet.insertRule('#' + video.id + '::cue {background: transparent}', 0);\n        } else if (video.classList.length !== 0) {\n          stylesheet.insertRule('.' + video.className + '::cue {background: transparent}', 0);\n        } else {\n          stylesheet.insertRule('video::cue {background: transparent}', 0);\n        }\n      }\n    } catch (e) {\n      logger.info('' + e.message);\n    }\n  }\n  /* Remove the extra cue style with transparent background for native cues. */\n\n\n  function removeNativeCueStyle() {\n    var styleElement = document.getElementById('native-cue-style');\n\n    if (styleElement) {\n      document.head.removeChild(styleElement);\n    }\n  }\n\n  function clearCaptionContainer() {\n    if (captionContainer) {\n      while (captionContainer.firstChild) {\n        captionContainer.removeChild(captionContainer.firstChild);\n      }\n    }\n  }\n\n  function setConfig(config) {\n    if (!config) {\n      return;\n    }\n\n    if (config.videoModel) {\n      videoModel = config.videoModel;\n    }\n  }\n\n  function setModeForTrackIdx(idx, mode) {\n    var track = getTrackByIdx(idx);\n\n    if (track && track.mode !== mode) {\n      track.mode = mode;\n    }\n  }\n\n  function getCurrentTrackInfo() {\n    return textTrackQueue[currentTrackIdx];\n  }\n\n  instance = {\n    initialize: initialize,\n    setDisplayCConTop: setDisplayCConTop,\n    addTextTrack: addTextTrack,\n    addCaptions: addCaptions,\n    getCurrentTrackIdx: getCurrentTrackIdx,\n    setCurrentTrackIdx: setCurrentTrackIdx,\n    getTrackIdxForId: getTrackIdxForId,\n    getCurrentTrackInfo: getCurrentTrackInfo,\n    setModeForTrackIdx: setModeForTrackIdx,\n    deleteCuesFromTrackIdx: deleteCuesFromTrackIdx,\n    deleteAllTextTracks: deleteAllTextTracks,\n    deleteTextTrack: deleteTextTrack,\n    setConfig: setConfig\n  };\n  setup();\n  return instance;\n}\n/**\n* The copyright in this software is being made available under the BSD License,\n* included below. This software may be subject to other third party and contributor\n* rights, including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2013, Dash Industry Forum.\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification,\n* are permitted provided that the following conditions are met:\n*  * Redistributions of source code must retain the above copyright notice, this\n*  list of conditions and the following disclaimer.\n*  * Redistributions in binary form must reproduce the above copyright notice,\n*  this list of conditions and the following disclaimer in the documentation and/or\n*  other materials provided with the distribution.\n*  * Neither the name of Dash Industry Forum nor the names of its\n*  contributors may be used to endorse or promote products derived from this software\n*  without specific prior written permission.\n*\n*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n*  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n*  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n*  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n*  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n*  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n*  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n*  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n*  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n*  POSSIBILITY OF SUCH DAMAGE.\n*/\n\n\nTextTracks.__dashjs_factory_name = 'TextTracks';\nexports.default = _FactoryMaker2.default.getSingletonFactory(TextTracks);","map":{"version":3,"mappings":"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","names":["TextTracks","context","eventBus","getInstance","instance","logger","Cue","videoModel","textTrackQueue","trackElementArr","currentTrackIdx","actualVideoLeft","actualVideoTop","actualVideoWidth","actualVideoHeight","captionContainer","videoSizeCheckInterval","fullscreenAttribute","displayCCOnTop","previousISDState","topZIndex","resizeObserver","setup","getLogger","initialize","window","navigator","VTTCue","TextTrackCue","document","fullscreenElement","undefined","webkitIsFullScreen","msFullscreenElement","mozFullScreen","createTrackForUserAgent","i","kind","label","id","lang","isTTML","isEmbedded","track","addTextTrack","setDisplayCConTop","value","style","zIndex","textTrackInfoVO","totalTextTracks","length","error","push","sort","a","b","index","getTTMLRenderingDiv","defaultIndex","call","defaultTrack","default","textTrack","getTrackByIdx","mode","Constants","TEXT_SHOWING","renderingType","addCaptions","captionData","trigger","Events","TEXT_TRACK_ADDED","setCurrentTrackIdx","onMetadataLoaded","checkVideoSize","off","PLAYBACK_METADATA_LOADED","on","idx","videoTextTrack","TEXT_HIDDEN","TEXT_TRACKS_QUEUE_INITIALIZED","tracks","getVideoVisibleVideoSize","viewWidth","viewHeight","videoWidth","videoHeight","aspectRatio","use80Percent","viewAspectRatio","videoAspectRatio","videoPictureWidth","videoPictureHeight","videoPictureXAspect","videoPictureYAspect","videoPictureWidthAspect","videoPictureHeightAspect","videoPictureAspect","x","y","w","h","forceDrawing","clientWidth","getClientWidth","clientHeight","getClientHeight","getVideoWidth","getVideoHeight","videoOffsetTop","getVideoRelativeOffsetTop","videoOffsetLeft","getVideoRelativeOffsetLeft","isFromCEA608","realVideoSize","newVideoWidth","newVideoHeight","newVideoLeft","newVideoTop","containerStyle","left","top","width","height","CAPTION_CONTAINER_RESIZE","activeCues","len","cue","scaleCue","activeCue","key","replaceValue","valueFontSize","valueLineHeight","elements","cellResolution","cellUnit","linePadding","hasOwnProperty","valueLinePadding","toString","elementsSpan","getElementsByClassName","cssText","replace","fontSize","j","lineHeight","k","isd","htmlCaptionDiv","getElementById","cueID","removeChild","renderCaption","finalCue","createElement","appendChild","uri","imsc1ImgUrnTester","smpteImgUrnTester","test","match","exec","imageId","parseInt","imageData","btoa","images","dataUrl","embeddedImages","err","info","CAPTION_RENDERED","captionDiv","trackIdx","timeOffset","self","Array","isArray","item","currentItem","type","start","end","cueHTMLElement","bind","onenter","debug","onexit","divs","childNodes","data","styles","align","line","position","size","addCue","e","deleteTrackCues","getTextTrack","getCurrentTrackIdx","getTrackIdxForId","trackId","setCueStyleOnTrack","clearInterval","ResizeObserver","_this","observe","getElement","setInterval","clearCaptionContainer","setNativeCueStyle","removeNativeCueStyle","cueInRange","isNaN","startTime","endTime","cues","lastIdx","r","removeCue","deleteCuesFromTrackIdx","deleteAllTextTracks","ln","unobserve","deleteTextTrack","splice","styleElement","head","stylesheet","sheet","video","insertRule","classList","className","message","firstChild","setConfig","config","setModeForTrackIdx","getCurrentTrackInfo","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"sources":["/home/landsys/react-node-video-streaming/client/node_modules/dashjs/src/streaming/text/TextTracks.js"],"sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport Constants from '../constants/Constants';\nimport EventBus from '../../core/EventBus';\nimport Events from '../../core/events/Events';\nimport FactoryMaker from '../../core/FactoryMaker';\nimport Debug from '../../core/Debug';\nimport { renderHTML } from 'imsc';\nimport { checkParameterType } from '../utils/SupervisorTools';\n\nfunction TextTracks() {\n\n    const context = this.context;\n    const eventBus = EventBus(context).getInstance();\n\n    let instance,\n        logger,\n        Cue,\n        videoModel,\n        textTrackQueue,\n        trackElementArr,\n        currentTrackIdx,\n        actualVideoLeft,\n        actualVideoTop,\n        actualVideoWidth,\n        actualVideoHeight,\n        captionContainer,\n        videoSizeCheckInterval,\n        fullscreenAttribute,\n        displayCCOnTop,\n        previousISDState,\n        topZIndex,\n        resizeObserver;\n\n    function setup() {\n        logger = Debug(context).getInstance().getLogger(instance);\n    }\n\n    function initialize() {\n        if (typeof window === 'undefined' || typeof navigator === 'undefined') {\n            return;\n        }\n\n        Cue = window.VTTCue || window.TextTrackCue;\n        textTrackQueue = [];\n        trackElementArr = [];\n        currentTrackIdx = -1;\n        actualVideoLeft = 0;\n        actualVideoTop = 0;\n        actualVideoWidth = 0;\n        actualVideoHeight = 0;\n        captionContainer = null;\n        videoSizeCheckInterval = null;\n        displayCCOnTop = false;\n        topZIndex = 2147483647;\n        previousISDState = null;\n\n        if (document.fullscreenElement !== undefined) {\n            fullscreenAttribute = 'fullscreenElement'; // Standard and Edge\n        } else if (document.webkitIsFullScreen !== undefined) {\n            fullscreenAttribute = 'webkitIsFullScreen'; // Chrome and Safari (and Edge)\n        } else if (document.msFullscreenElement) { // IE11\n            fullscreenAttribute = 'msFullscreenElement';\n        } else if (document.mozFullScreen) { // Firefox\n            fullscreenAttribute = 'mozFullScreen';\n        }\n    }\n\n    function createTrackForUserAgent (i) {\n        const kind = textTrackQueue[i].kind;\n        const label = textTrackQueue[i].id !== undefined ? textTrackQueue[i].id : textTrackQueue[i].lang;\n        const lang = textTrackQueue[i].lang;\n        const isTTML = textTrackQueue[i].isTTML;\n        const isEmbedded = textTrackQueue[i].isEmbedded;\n        const track = videoModel.addTextTrack(kind, label, lang, isTTML, isEmbedded);\n        return track;\n    }\n\n    function setDisplayCConTop(value) {\n        checkParameterType(value, 'boolean');\n        displayCCOnTop = value;\n        if (!captionContainer || document[fullscreenAttribute]) {\n            return;\n        }\n        captionContainer.style.zIndex = value ? topZIndex : null;\n    }\n\n    function addTextTrack(textTrackInfoVO, totalTextTracks) {\n        if (textTrackQueue.length === totalTextTracks) {\n            logger.error('Trying to add too many tracks.');\n            return;\n        }\n\n        textTrackQueue.push(textTrackInfoVO);\n\n        if (textTrackQueue.length === totalTextTracks) {\n            textTrackQueue.sort(function (a, b) { //Sort in same order as in manifest\n                return a.index - b.index;\n            });\n            captionContainer = videoModel.getTTMLRenderingDiv();\n            let defaultIndex = -1;\n            for (let i = 0 ; i < textTrackQueue.length; i++) {\n                const track = createTrackForUserAgent.call(this, i);\n                trackElementArr.push(track); //used to remove tracks from video element when added manually\n\n                if (textTrackQueue[i].defaultTrack) {\n                    // track.default is an object property identifier that is a reserved word\n                    // The following jshint directive is used to suppressed the warning \"Expected an identifier and instead saw 'default' (a reserved word)\"\n                    /*jshint -W024 */\n                    track.default = true;\n                    defaultIndex = i;\n                }\n\n                const textTrack = getTrackByIdx(i);\n                if (textTrack) {\n                    //each time a track is created, its mode should be showing by default\n                    //sometime, it's not on Chrome\n                    textTrack.mode = Constants.TEXT_SHOWING;\n                    if (captionContainer && (textTrackQueue[i].isTTML || textTrackQueue[i].isEmbedded)) {\n                        textTrack.renderingType = 'html';\n                    } else {\n                        textTrack.renderingType = 'default';\n                    }\n                }\n                this.addCaptions(i, 0, textTrackQueue[i].captionData);\n                eventBus.trigger(Events.TEXT_TRACK_ADDED);\n            }\n\n            //set current track index in textTrackQueue array\n            setCurrentTrackIdx.call(this, defaultIndex);\n\n            if (defaultIndex >= 0) {\n\n                let onMetadataLoaded = function () {\n                    const track = getTrackByIdx(defaultIndex);\n                    if (track) {\n                        checkVideoSize.call(this, track, true);\n                    }\n                    eventBus.off(Events.PLAYBACK_METADATA_LOADED, onMetadataLoaded, this);\n                };\n\n                eventBus.on(Events.PLAYBACK_METADATA_LOADED, onMetadataLoaded, this);\n\n                for (let idx = 0; idx < textTrackQueue.length; idx++) {\n                    const videoTextTrack = getTrackByIdx(idx);\n                    if (videoTextTrack) {\n                        videoTextTrack.mode = (idx === defaultIndex) ? Constants.TEXT_SHOWING : Constants.TEXT_HIDDEN;\n                    }\n                }\n            }\n\n            eventBus.trigger(Events.TEXT_TRACKS_QUEUE_INITIALIZED, {\n                index: currentTrackIdx,\n                tracks: textTrackQueue\n            }); //send default idx.\n        }\n    }\n\n    function getVideoVisibleVideoSize(viewWidth, viewHeight, videoWidth, videoHeight, aspectRatio, use80Percent) {\n        const viewAspectRatio = viewWidth / viewHeight;\n        const videoAspectRatio = videoWidth / videoHeight;\n\n        let videoPictureWidth = 0;\n        let videoPictureHeight = 0;\n\n        if (viewAspectRatio > videoAspectRatio) {\n            videoPictureHeight = viewHeight;\n            videoPictureWidth = (videoPictureHeight / videoHeight) * videoWidth;\n        } else {\n            videoPictureWidth = viewWidth;\n            videoPictureHeight = (videoPictureWidth / videoWidth) * videoHeight;\n        }\n\n        let videoPictureXAspect = 0;\n        let videoPictureYAspect = 0;\n        let videoPictureWidthAspect = 0;\n        let videoPictureHeightAspect = 0;\n        const videoPictureAspect = videoPictureWidth / videoPictureHeight;\n\n        if (videoPictureAspect > aspectRatio) {\n            videoPictureHeightAspect = videoPictureHeight;\n            videoPictureWidthAspect = videoPictureHeight * aspectRatio;\n        } else {\n            videoPictureWidthAspect = videoPictureWidth;\n            videoPictureHeightAspect = videoPictureWidth / aspectRatio;\n        }\n        videoPictureXAspect = (viewWidth - videoPictureWidthAspect) / 2;\n        videoPictureYAspect = (viewHeight - videoPictureHeightAspect) / 2;\n\n        if (use80Percent) {\n            return {\n                x: videoPictureXAspect + (videoPictureWidthAspect * 0.1),\n                y: videoPictureYAspect + (videoPictureHeightAspect * 0.1),\n                w: videoPictureWidthAspect * 0.8,\n                h: videoPictureHeightAspect * 0.8\n            }; /* Maximal picture size in videos aspect ratio */\n        } else {\n            return {\n                x: videoPictureXAspect,\n                y: videoPictureYAspect,\n                w: videoPictureWidthAspect,\n                h: videoPictureHeightAspect\n            }; /* Maximal picture size in videos aspect ratio */\n        }\n    }\n\n    function checkVideoSize(track, forceDrawing) {\n        const clientWidth = videoModel.getClientWidth();\n        const clientHeight = videoModel.getClientHeight();\n        const videoWidth = videoModel.getVideoWidth();\n        const videoHeight = videoModel.getVideoHeight();\n        const videoOffsetTop = videoModel.getVideoRelativeOffsetTop();\n        const videoOffsetLeft = videoModel.getVideoRelativeOffsetLeft();\n\n        if (videoWidth !== 0 && videoHeight !== 0) {\n\n            let aspectRatio =  videoWidth / videoHeight;\n            let use80Percent = false;\n            if (track.isFromCEA608) {\n                // If this is CEA608 then use predefined aspect ratio\n                aspectRatio = 3.5 / 3.0;\n                use80Percent = true;\n            }\n\n            const realVideoSize = getVideoVisibleVideoSize.call(this, clientWidth, clientHeight, videoWidth, videoHeight, aspectRatio, use80Percent);\n\n            const newVideoWidth = realVideoSize.w;\n            const newVideoHeight = realVideoSize.h;\n            const newVideoLeft = realVideoSize.x;\n            const newVideoTop = realVideoSize.y;\n\n            if (newVideoWidth != actualVideoWidth || newVideoHeight != actualVideoHeight || newVideoLeft != actualVideoLeft || newVideoTop != actualVideoTop || forceDrawing) {\n                actualVideoLeft = newVideoLeft + videoOffsetLeft;\n                actualVideoTop = newVideoTop + videoOffsetTop;\n                actualVideoWidth = newVideoWidth;\n                actualVideoHeight = newVideoHeight;\n\n                if (captionContainer) {\n                    const containerStyle = captionContainer.style;\n                    if (containerStyle) {\n                        containerStyle.left = actualVideoLeft + 'px';\n                        containerStyle.top = actualVideoTop + 'px';\n                        containerStyle.width = actualVideoWidth + 'px';\n                        containerStyle.height = actualVideoHeight + 'px';\n                        containerStyle.zIndex = (fullscreenAttribute && document[fullscreenAttribute]) || displayCCOnTop ? topZIndex : null;\n                        eventBus.trigger(Events.CAPTION_CONTAINER_RESIZE);\n                    }\n                }\n\n                // Video view has changed size, so resize any active cues\n                const activeCues = track.activeCues;\n                if (activeCues) {\n                    const len = activeCues.length;\n                    for (let i = 0; i < len; ++i) {\n                        const cue = activeCues[i];\n                        cue.scaleCue(cue);\n                    }\n                }\n            }\n        }\n    }\n\n    function scaleCue(activeCue) {\n        const videoWidth = actualVideoWidth;\n        const videoHeight = actualVideoHeight;\n        let key,\n            replaceValue,\n            valueFontSize,\n            valueLineHeight,\n            elements;\n\n        if (activeCue.cellResolution) {\n            const cellUnit = [videoWidth / activeCue.cellResolution[0], videoHeight / activeCue.cellResolution[1]];\n            if (activeCue.linePadding) {\n                for (key in activeCue.linePadding) {\n                    if (activeCue.linePadding.hasOwnProperty(key)) {\n                        const valueLinePadding = activeCue.linePadding[key];\n                        replaceValue = (valueLinePadding * cellUnit[0]).toString();\n                        // Compute the CellResolution unit in order to process properties using sizing (fontSize, linePadding, etc).\n                        const elementsSpan = document.getElementsByClassName('spanPadding');\n                        for (let i = 0; i < elementsSpan.length; i++) {\n                            elementsSpan[i].style.cssText = elementsSpan[i].style.cssText.replace(/(padding-left\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                            elementsSpan[i].style.cssText = elementsSpan[i].style.cssText.replace(/(padding-right\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                        }\n                    }\n                }\n            }\n\n            if (activeCue.fontSize) {\n                for (key in activeCue.fontSize) {\n                    if (activeCue.fontSize.hasOwnProperty(key)) {\n                        if (activeCue.fontSize[key][0] === '%') {\n                            valueFontSize = activeCue.fontSize[key][1] / 100;\n                        } else if (activeCue.fontSize[key][0] === 'c') {\n                            valueFontSize = activeCue.fontSize[key][1];\n                        }\n\n                        replaceValue = (valueFontSize * cellUnit[1]).toString();\n\n                        if (key !== 'defaultFontSize') {\n                            elements = document.getElementsByClassName(key);\n                        } else {\n                            elements = document.getElementsByClassName('paragraph');\n                        }\n\n                        for (let j = 0; j < elements.length; j++) {\n                            elements[j].style.cssText = elements[j].style.cssText.replace(/(font-size\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                        }\n                    }\n                }\n\n                if (activeCue.lineHeight) {\n                    for (key in activeCue.lineHeight) {\n                        if (activeCue.lineHeight.hasOwnProperty(key)) {\n                            if (activeCue.lineHeight[key][0] === '%') {\n                                valueLineHeight = activeCue.lineHeight[key][1] / 100;\n                            } else if (activeCue.fontSize[key][0] === 'c') {\n                                valueLineHeight = activeCue.lineHeight[key][1];\n                            }\n\n                            replaceValue = (valueLineHeight * cellUnit[1]).toString();\n                            elements = document.getElementsByClassName(key);\n                            for (let k = 0; k < elements.length; k++) {\n                                elements[k].style.cssText = elements[k].style.cssText.replace(/(line-height\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        if (activeCue.isd) {\n            let htmlCaptionDiv = document.getElementById(activeCue.cueID);\n            if (htmlCaptionDiv) {\n                captionContainer.removeChild(htmlCaptionDiv);\n            }\n            renderCaption(activeCue);\n        }\n    }\n\n    function renderCaption(cue) {\n        if (captionContainer) {\n            const finalCue = document.createElement('div');\n            captionContainer.appendChild(finalCue);\n            previousISDState = renderHTML(cue.isd, finalCue, function (uri) {\n                const imsc1ImgUrnTester = /^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/;\n                const smpteImgUrnTester = /^#(.*)$/;\n                if (imsc1ImgUrnTester.test(uri)) {\n                    const match = imsc1ImgUrnTester.exec(uri);\n                    const imageId = parseInt(match[4], 10) - 1;\n                    const imageData = btoa(cue.images[imageId]);\n                    const dataUrl = 'data:image/png;base64,' + imageData;\n                    return dataUrl;\n                } else if (smpteImgUrnTester.test(uri)) {\n                    const match = smpteImgUrnTester.exec(uri);\n                    const imageId = match[1];\n                    const dataUrl = 'data:image/png;base64,' + cue.embeddedImages[imageId];\n                    return dataUrl;\n                } else {\n                    return null;\n                }\n            }, captionContainer.clientHeight, captionContainer.clientWidth, false/*displayForcedOnlyMode*/, function (err) {\n                logger.info('renderCaption :', err);\n                //TODO add ErrorHandler management\n            }, previousISDState, true /*enableRollUp*/);\n            finalCue.id = cue.cueID;\n            eventBus.trigger(Events.CAPTION_RENDERED, { captionDiv: finalCue, currentTrackIdx });\n        }\n    }\n\n    /*\n     * Add captions to track, store for later adding, or add captions added before\n     */\n    function addCaptions(trackIdx, timeOffset, captionData) {\n        const track = getTrackByIdx(trackIdx);\n        const self = this;\n\n        if (!track) {\n            return;\n        }\n\n        if (!Array.isArray(captionData) || captionData.length === 0) {\n            return;\n        }\n\n        for (let item = 0; item < captionData.length; item++) {\n            let cue;\n            const currentItem = captionData[item];\n\n            track.cellResolution = currentItem.cellResolution;\n            track.isFromCEA608 = currentItem.isFromCEA608;\n\n            if (currentItem.type === 'html' && captionContainer) {\n                cue = new Cue(currentItem.start - timeOffset, currentItem.end - timeOffset, '');\n                cue.cueHTMLElement = currentItem.cueHTMLElement;\n                cue.isd = currentItem.isd;\n                cue.images = currentItem.images;\n                cue.embeddedImages = currentItem.embeddedImages;\n                cue.cueID = currentItem.cueID;\n                cue.scaleCue = scaleCue.bind(self);\n                //useful parameters for cea608 subtitles, not for TTML one.\n                cue.cellResolution = currentItem.cellResolution;\n                cue.lineHeight = currentItem.lineHeight;\n                cue.linePadding = currentItem.linePadding;\n                cue.fontSize = currentItem.fontSize;\n\n                captionContainer.style.left = actualVideoLeft + 'px';\n                captionContainer.style.top = actualVideoTop + 'px';\n                captionContainer.style.width = actualVideoWidth + 'px';\n                captionContainer.style.height = actualVideoHeight + 'px';\n\n                cue.onenter = function () {\n                    if (track.mode === Constants.TEXT_SHOWING) {\n                        if (this.isd) {\n                            renderCaption(this);\n                            logger.debug('Cue enter id:' + this.cueID);\n                        } else {\n                            captionContainer.appendChild(this.cueHTMLElement);\n                            scaleCue.call(self, this);\n                            eventBus.trigger(Events.CAPTION_RENDERED, { captionDiv: this.cueHTMLElement, currentTrackIdx });\n                        }\n                    }\n                };\n\n                cue.onexit = function () {\n                    if (captionContainer) {\n                        const divs = captionContainer.childNodes;\n                        for (let i = 0; i < divs.length; ++i) {\n                            if (divs[i].id === this.cueID) {\n                                logger.debug('Cue exit id:' + divs[i].id);\n                                captionContainer.removeChild(divs[i]);\n                                --i;\n                            }\n                        }\n                    }\n                };\n            } else {\n                if (currentItem.data) {\n                    cue = new Cue(currentItem.start - timeOffset, currentItem.end - timeOffset, currentItem.data);\n                    if (currentItem.styles) {\n                        if (currentItem.styles.align !== undefined && 'align' in cue) {\n                            cue.align = currentItem.styles.align;\n                        }\n                        if (currentItem.styles.line !== undefined && 'line' in cue) {\n                            cue.line = currentItem.styles.line;\n                        }\n                        if (currentItem.styles.position !== undefined && 'position' in cue) {\n                            cue.position = currentItem.styles.position;\n                        }\n                        if (currentItem.styles.size !== undefined && 'size' in cue) {\n                            cue.size = currentItem.styles.size;\n                        }\n                    }\n                    cue.onenter = function () {\n                        if (track.mode === Constants.TEXT_SHOWING) {\n                            eventBus.trigger(Events.CAPTION_RENDERED, { currentTrackIdx });\n                        }\n                    };\n                }\n            }\n            try {\n                if (cue) {\n                    track.addCue(cue);\n                } else {\n                    logger.error('impossible to display subtitles.');\n                }\n            } catch (e) {\n                // Edge crash, delete everything and start adding again\n                // @see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11979877/\n                deleteTrackCues(track);\n                track.addCue(cue);\n                throw e;\n            }\n        }\n    }\n\n    function getTrackByIdx(idx) {\n        return idx >= 0 && textTrackQueue[idx] ?\n            videoModel.getTextTrack(textTrackQueue[idx].kind, textTrackQueue[idx].id, textTrackQueue[idx].lang, textTrackQueue[idx].isTTML, textTrackQueue[idx].isEmbedded) : null;\n    }\n\n    function getCurrentTrackIdx() {\n        return currentTrackIdx;\n    }\n\n    function getTrackIdxForId(trackId) {\n        let idx = -1;\n        for (let i = 0; i < textTrackQueue.length; i++) {\n            if (textTrackQueue[i].id === trackId) {\n                idx = i;\n                break;\n            }\n        }\n\n        return idx;\n    }\n\n    function setCurrentTrackIdx(idx) {\n        if (idx === currentTrackIdx) {\n            return;\n        }\n        currentTrackIdx = idx;\n        const track = getTrackByIdx(currentTrackIdx);\n        setCueStyleOnTrack.call(this, track);\n\n        if (videoSizeCheckInterval) {\n            clearInterval(videoSizeCheckInterval);\n            videoSizeCheckInterval = null;\n        }\n\n        if (track && track.renderingType === 'html') {\n            checkVideoSize.call(this, track, true);\n            if (window.ResizeObserver) {\n                resizeObserver = new window.ResizeObserver(() => {\n                    checkVideoSize.call(this, track, true);\n                });\n                resizeObserver.observe(videoModel.getElement());\n            } else {\n                videoSizeCheckInterval = setInterval(checkVideoSize.bind(this, track), 500);\n            }\n        }\n    }\n\n    function setCueStyleOnTrack(track) {\n        clearCaptionContainer.call(this);\n        if (track) {\n            if (track.renderingType === 'html') {\n                setNativeCueStyle.call(this);\n            } else {\n                removeNativeCueStyle.call(this);\n            }\n        } else {\n            removeNativeCueStyle.call(this);\n        }\n    }\n\n    function cueInRange(cue, start, end) {\n        return (isNaN(start) || cue.startTime >= start) && (isNaN(end) || cue.endTime <= end);\n    }\n\n    function deleteTrackCues(track, start, end) {\n        if (track.cues) {\n            const cues = track.cues;\n            const lastIdx = cues.length - 1;\n\n            for (let r = lastIdx; r >= 0 ; r--) {\n                if (cueInRange(cues[r], start, end)) {\n                    track.removeCue(cues[r]);\n                }\n            }\n        }\n    }\n\n    function deleteCuesFromTrackIdx(trackIdx, start, end) {\n        const track = getTrackByIdx(trackIdx);\n        if (track) {\n            deleteTrackCues(track, start, end);\n        }\n    }\n\n    function deleteAllTextTracks() {\n        const ln = trackElementArr ? trackElementArr.length : 0;\n        for (let i = 0; i < ln; i++) {\n            const track = getTrackByIdx(i);\n            if (track) {\n                deleteTrackCues.call(this, track);\n                track.mode = 'disabled';\n            }\n        }\n        trackElementArr = [];\n        textTrackQueue = [];\n        if (videoSizeCheckInterval) {\n            clearInterval(videoSizeCheckInterval);\n            videoSizeCheckInterval = null;\n        }\n        if (resizeObserver && videoModel) {\n            resizeObserver.unobserve(videoModel.getElement());\n            resizeObserver = null;\n        }\n        currentTrackIdx = -1;\n        clearCaptionContainer.call(this);\n    }\n\n    function deleteTextTrack(idx) {\n        videoModel.removeChild(trackElementArr[idx]);\n        trackElementArr.splice(idx, 1);\n    }\n\n    /* Set native cue style to transparent background to avoid it being displayed. */\n    function setNativeCueStyle() {\n        let styleElement = document.getElementById('native-cue-style');\n        if (styleElement) {\n            return; //Already set\n        }\n\n        styleElement = document.createElement('style');\n        styleElement.id = 'native-cue-style';\n        document.head.appendChild(styleElement);\n        const stylesheet = styleElement.sheet;\n        const video = videoModel.getElement();\n        try {\n            if (video) {\n                if (video.id) {\n                    stylesheet.insertRule('#' + video.id + '::cue {background: transparent}', 0);\n                } else if (video.classList.length !== 0) {\n                    stylesheet.insertRule('.' + video.className + '::cue {background: transparent}', 0);\n                } else {\n                    stylesheet.insertRule('video::cue {background: transparent}', 0);\n                }\n            }\n        } catch (e) {\n            logger.info('' + e.message);\n        }\n    }\n\n    /* Remove the extra cue style with transparent background for native cues. */\n    function removeNativeCueStyle() {\n        const styleElement = document.getElementById('native-cue-style');\n        if (styleElement) {\n            document.head.removeChild(styleElement);\n        }\n    }\n\n    function clearCaptionContainer() {\n        if (captionContainer) {\n            while (captionContainer.firstChild) {\n                captionContainer.removeChild(captionContainer.firstChild);\n            }\n        }\n    }\n\n    function setConfig(config) {\n        if (!config) {\n            return;\n        }\n        if (config.videoModel) {\n            videoModel = config.videoModel;\n        }\n    }\n\n    function setModeForTrackIdx(idx, mode) {\n        const track = getTrackByIdx(idx);\n        if (track && track.mode !== mode) {\n            track.mode = mode;\n        }\n    }\n\n    function getCurrentTrackInfo() {\n        return textTrackQueue[currentTrackIdx];\n    }\n\n    instance = {\n        initialize: initialize,\n        setDisplayCConTop: setDisplayCConTop,\n        addTextTrack: addTextTrack,\n        addCaptions: addCaptions,\n        getCurrentTrackIdx: getCurrentTrackIdx,\n        setCurrentTrackIdx: setCurrentTrackIdx,\n        getTrackIdxForId: getTrackIdxForId,\n        getCurrentTrackInfo: getCurrentTrackInfo,\n        setModeForTrackIdx: setModeForTrackIdx,\n        deleteCuesFromTrackIdx: deleteCuesFromTrackIdx,\n        deleteAllTextTracks: deleteAllTextTracks,\n        deleteTextTrack: deleteTextTrack,\n        setConfig: setConfig\n    };\n\n    setup();\n\n    return instance;\n}\n\nTextTracks.__dashjs_factory_name = 'TextTracks';\nexport default FactoryMaker.getSingletonFactory(TextTracks);\n"]},"metadata":{},"sourceType":"script"}