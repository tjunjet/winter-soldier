{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _FactoryMaker = require('../../core/FactoryMaker');\n\nvar _FactoryMaker2 = _interopRequireDefault(_FactoryMaker);\n\nvar _Debug = require('../../core/Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _Constants = require('../constants/Constants');\n\nvar _Constants2 = _interopRequireDefault(_Constants);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction CapabilitiesFilter() {\n  var context = this.context;\n  var instance = void 0,\n      adapter = void 0,\n      capabilities = void 0,\n      settings = void 0,\n      logger = void 0,\n      customCapabilitiesFilters = void 0;\n\n  function setup() {\n    logger = (0, _Debug2.default)(context).getInstance().getLogger(instance);\n  }\n\n  function setConfig(config) {\n    if (!config) {\n      return;\n    }\n\n    if (config.adapter) {\n      adapter = config.adapter;\n    }\n\n    if (config.capabilities) {\n      capabilities = config.capabilities;\n    }\n\n    if (config.settings) {\n      settings = config.settings;\n    }\n  }\n\n  function filterUnsupportedFeaturesOfPeriod(streamInfo) {\n    _filterUnsupportedCodecs(_Constants2.default.VIDEO, streamInfo);\n\n    _filterUnsupportedCodecs(_Constants2.default.AUDIO, streamInfo);\n\n    if (settings.get().streaming.filterUnsupportedEssentialProperties) {\n      _filterUnsupportedEssentialProperties(streamInfo);\n    }\n\n    _applyCustomFilters(streamInfo);\n  }\n\n  function _filterUnsupportedCodecs(type, streamInfo) {\n    var realPeriod = adapter.getRealPeriodByIndex(streamInfo ? streamInfo.index : null);\n\n    if (!realPeriod || !realPeriod.AdaptationSet_asArray || realPeriod.AdaptationSet_asArray.length === 0) {\n      return;\n    }\n\n    realPeriod.AdaptationSet_asArray = realPeriod.AdaptationSet_asArray.filter(function (as) {\n      if (!as.Representation_asArray || as.Representation_asArray.length === 0 || !adapter.getIsTypeOf(as, type)) {\n        return true;\n      }\n\n      as.Representation_asArray = as.Representation_asArray.filter(function (_, i) {\n        var codec = adapter.getCodec(as, i, true);\n\n        if (!capabilities.supportsCodec(codec)) {\n          logger.error('[Stream] codec not supported: ' + codec);\n          return false;\n        }\n\n        return true;\n      });\n      return as.Representation_asArray && as.Representation_asArray.length > 0;\n    });\n  }\n\n  function _filterUnsupportedEssentialProperties(streamInfo) {\n    var realPeriod = adapter.getRealPeriodByIndex(streamInfo ? streamInfo.index : null);\n\n    if (!realPeriod || !realPeriod.AdaptationSet_asArray || realPeriod.AdaptationSet_asArray.length === 0) {\n      return;\n    }\n\n    realPeriod.AdaptationSet_asArray = realPeriod.AdaptationSet_asArray.filter(function (as) {\n      if (!as.Representation_asArray || as.Representation_asArray.length === 0) {\n        return true;\n      }\n\n      as.Representation_asArray = as.Representation_asArray.filter(function (rep) {\n        var essentialProperties = adapter.getEssentialPropertiesForRepresentation(rep);\n\n        if (essentialProperties && essentialProperties.length > 0) {\n          var i = 0;\n\n          while (i < essentialProperties.length) {\n            if (!capabilities.supportsEssentialProperty(essentialProperties[i])) {\n              logger.debug('[Stream] EssentialProperty not supported: ' + essentialProperties[i].schemeIdUri);\n              return false;\n            }\n\n            i += 1;\n          }\n        }\n\n        return true;\n      });\n      return as.Representation_asArray && as.Representation_asArray.length > 0;\n    });\n  }\n\n  function _applyCustomFilters(streamInfo) {\n    if (!customCapabilitiesFilters || customCapabilitiesFilters.length === 0) return;\n    var realPeriod = adapter.getRealPeriodByIndex(streamInfo ? streamInfo.index : null);\n\n    if (!realPeriod || !realPeriod.AdaptationSet_asArray || realPeriod.AdaptationSet_asArray.length === 0) {\n      return;\n    }\n\n    realPeriod.AdaptationSet_asArray = realPeriod.AdaptationSet_asArray.filter(function (as) {\n      if (!as.Representation_asArray || as.Representation_asArray.length === 0) {\n        return true;\n      }\n\n      as.Representation_asArray = as.Representation_asArray.filter(function (representation) {\n        return !customCapabilitiesFilters.some(function (customFilter) {\n          return !customFilter(representation);\n        });\n      });\n      return as.Representation_asArray && as.Representation_asArray.length > 0;\n    });\n  }\n\n  function setCustomCapabilitiesFilters(customFilters) {\n    customCapabilitiesFilters = customFilters;\n  }\n\n  instance = {\n    setConfig: setConfig,\n    filterUnsupportedFeaturesOfPeriod: filterUnsupportedFeaturesOfPeriod,\n    setCustomCapabilitiesFilters: setCustomCapabilitiesFilters\n  };\n  setup();\n  return instance;\n}\n\nCapabilitiesFilter.__dashjs_factory_name = 'CapabilitiesFilter';\nexports.default = _FactoryMaker2.default.getSingletonFactory(CapabilitiesFilter);","map":{"version":3,"mappings":"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","names":["CapabilitiesFilter","context","instance","adapter","capabilities","settings","logger","customCapabilitiesFilters","setup","getInstance","getLogger","setConfig","config","filterUnsupportedFeaturesOfPeriod","streamInfo","_filterUnsupportedCodecs","Constants","VIDEO","AUDIO","get","streaming","filterUnsupportedEssentialProperties","_filterUnsupportedEssentialProperties","_applyCustomFilters","type","realPeriod","getRealPeriodByIndex","index","AdaptationSet_asArray","length","filter","as","Representation_asArray","getIsTypeOf","_","i","codec","getCodec","supportsCodec","error","rep","essentialProperties","getEssentialPropertiesForRepresentation","supportsEssentialProperty","debug","schemeIdUri","representation","some","customFilter","setCustomCapabilitiesFilters","customFilters","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"sources":["/home/landsys/react-node-video-streaming/client/node_modules/dashjs/src/streaming/utils/CapabilitiesFilter.js"],"sourcesContent":["import FactoryMaker from '../../core/FactoryMaker';\nimport Debug from '../../core/Debug';\nimport Constants from '../constants/Constants';\n\nfunction CapabilitiesFilter() {\n    const context = this.context;\n    let instance,\n        adapter,\n        capabilities,\n        settings,\n        logger,\n        customCapabilitiesFilters;\n\n\n    function setup() {\n        logger = Debug(context).getInstance().getLogger(instance);\n    }\n\n    function setConfig(config) {\n        if (!config) {\n            return;\n        }\n\n        if (config.adapter) {\n            adapter = config.adapter;\n        }\n\n        if (config.capabilities) {\n            capabilities = config.capabilities;\n        }\n\n        if (config.settings) {\n            settings = config.settings;\n        }\n\n    }\n\n    function filterUnsupportedFeaturesOfPeriod(streamInfo) {\n        _filterUnsupportedCodecs(Constants.VIDEO, streamInfo);\n        _filterUnsupportedCodecs(Constants.AUDIO, streamInfo);\n\n        if (settings.get().streaming.filterUnsupportedEssentialProperties) {\n            _filterUnsupportedEssentialProperties(streamInfo);\n        }\n\n        _applyCustomFilters(streamInfo);\n    }\n\n\n    function _filterUnsupportedCodecs(type, streamInfo) {\n        const realPeriod = adapter.getRealPeriodByIndex(streamInfo ? streamInfo.index : null);\n\n        if (!realPeriod || !realPeriod.AdaptationSet_asArray || realPeriod.AdaptationSet_asArray.length === 0) {\n            return;\n        }\n\n        realPeriod.AdaptationSet_asArray = realPeriod.AdaptationSet_asArray.filter((as) => {\n\n            if (!as.Representation_asArray || as.Representation_asArray.length === 0 || !adapter.getIsTypeOf(as, type)) {\n                return true;\n            }\n\n            as.Representation_asArray = as.Representation_asArray.filter((_, i) => {\n                const codec = adapter.getCodec(as, i, true);\n                if (!capabilities.supportsCodec(codec)) {\n                    logger.error('[Stream] codec not supported: ' + codec);\n                    return false;\n                }\n                return true;\n            });\n\n            return as.Representation_asArray && as.Representation_asArray.length > 0;\n        });\n\n    }\n\n    function _filterUnsupportedEssentialProperties(streamInfo) {\n        const realPeriod = adapter.getRealPeriodByIndex(streamInfo ? streamInfo.index : null);\n\n        if (!realPeriod || !realPeriod.AdaptationSet_asArray || realPeriod.AdaptationSet_asArray.length === 0) {\n            return;\n        }\n\n        realPeriod.AdaptationSet_asArray = realPeriod.AdaptationSet_asArray.filter((as) => {\n\n            if (!as.Representation_asArray || as.Representation_asArray.length === 0) {\n                return true;\n            }\n\n            as.Representation_asArray = as.Representation_asArray.filter((rep) => {\n                const essentialProperties = adapter.getEssentialPropertiesForRepresentation(rep);\n\n                if (essentialProperties && essentialProperties.length > 0) {\n                    let i = 0;\n                    while (i < essentialProperties.length) {\n                        if (!capabilities.supportsEssentialProperty(essentialProperties[i])) {\n                            logger.debug('[Stream] EssentialProperty not supported: ' + essentialProperties[i].schemeIdUri);\n                            return false;\n                        }\n                        i += 1;\n                    }\n                }\n\n                return true;\n            });\n\n            return as.Representation_asArray && as.Representation_asArray.length > 0;\n        });\n\n    }\n\n    function _applyCustomFilters(streamInfo) {\n        if (!customCapabilitiesFilters || customCapabilitiesFilters.length === 0) return;\n\n        const realPeriod = adapter.getRealPeriodByIndex(streamInfo ? streamInfo.index : null);\n\n        if (!realPeriod || !realPeriod.AdaptationSet_asArray || realPeriod.AdaptationSet_asArray.length === 0) {\n            return;\n        }\n\n        realPeriod.AdaptationSet_asArray = realPeriod.AdaptationSet_asArray.filter((as) => {\n\n            if (!as.Representation_asArray || as.Representation_asArray.length === 0) {\n                return true;\n            }\n\n            as.Representation_asArray = as.Representation_asArray.filter((representation) => {\n                return !customCapabilitiesFilters.some(customFilter => !customFilter(representation));\n            });\n\n            return as.Representation_asArray && as.Representation_asArray.length > 0;\n        });\n    }\n\n    function setCustomCapabilitiesFilters(customFilters) {\n        customCapabilitiesFilters = customFilters;\n    }\n\n    instance = {\n        setConfig,\n        filterUnsupportedFeaturesOfPeriod,\n        setCustomCapabilitiesFilters\n    };\n\n    setup();\n\n    return instance;\n}\n\nCapabilitiesFilter.__dashjs_factory_name = 'CapabilitiesFilter';\nexport default FactoryMaker.getSingletonFactory(CapabilitiesFilter);\n"]},"metadata":{},"sourceType":"script"}