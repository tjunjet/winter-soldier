{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _FactoryMaker = require('../../core/FactoryMaker');\n\nvar _FactoryMaker2 = _interopRequireDefault(_FactoryMaker);\n\nvar _SwitchRequest = require('./SwitchRequest');\n\nvar _SwitchRequest2 = _interopRequireDefault(_SwitchRequest);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n* The copyright in this software is being made available under the BSD License,\n* included below. This software may be subject to other third party and contributor\n* rights, including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2013, Dash Industry Forum.\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification,\n* are permitted provided that the following conditions are met:\n*  * Redistributions of source code must retain the above copyright notice, this\n*  list of conditions and the following disclaimer.\n*  * Redistributions in binary form must reproduce the above copyright notice,\n*  this list of conditions and the following disclaimer in the documentation and/or\n*  other materials provided with the distribution.\n*  * Neither the name of Dash Industry Forum nor the names of its\n*  contributors may be used to endorse or promote products derived from this software\n*  without specific prior written permission.\n*\n*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n*  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n*  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n*  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n*  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n*  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n*  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n*  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n*  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n*  POSSIBILITY OF SUCH DAMAGE.\n*/\n\n\nvar SWITCH_REQUEST_HISTORY_DEPTH = 8; // must be > SwitchHistoryRule SAMPLE_SIZE to enable rule\n\nfunction SwitchRequestHistory() {\n  var switchRequests = []; // running total\n\n  var srHistory = []; // history of each switch\n\n  function push(switchRequest) {\n    if (switchRequest.newValue === _SwitchRequest2.default.NO_CHANGE) {\n      switchRequest.newValue = switchRequest.oldValue;\n    }\n\n    if (!switchRequests[switchRequest.oldValue]) {\n      switchRequests[switchRequest.oldValue] = {\n        noDrops: 0,\n        drops: 0,\n        dropSize: 0\n      };\n    } // Set switch details\n\n\n    var indexDiff = switchRequest.newValue - switchRequest.oldValue;\n    var drop = indexDiff < 0 ? 1 : 0;\n    var dropSize = drop ? -indexDiff : 0;\n    var noDrop = drop ? 0 : 1; // Update running totals\n\n    switchRequests[switchRequest.oldValue].drops += drop;\n    switchRequests[switchRequest.oldValue].dropSize += dropSize;\n    switchRequests[switchRequest.oldValue].noDrops += noDrop; // Save to history\n\n    srHistory.push({\n      idx: switchRequest.oldValue,\n      noDrop: noDrop,\n      drop: drop,\n      dropSize: dropSize\n    }); // Shift earliest switch off srHistory and readjust to keep depth of running totals constant\n\n    if (srHistory.length > SWITCH_REQUEST_HISTORY_DEPTH) {\n      var srHistoryFirst = srHistory.shift();\n      switchRequests[srHistoryFirst.idx].drops -= srHistoryFirst.drop;\n      switchRequests[srHistoryFirst.idx].dropSize -= srHistoryFirst.dropSize;\n      switchRequests[srHistoryFirst.idx].noDrops -= srHistoryFirst.noDrop;\n    }\n  }\n\n  function getSwitchRequests() {\n    return switchRequests;\n  }\n\n  function reset() {\n    switchRequests = [];\n    srHistory = [];\n  }\n\n  return {\n    push: push,\n    getSwitchRequests: getSwitchRequests,\n    reset: reset\n  };\n}\n\nSwitchRequestHistory.__dashjs_factory_name = 'SwitchRequestHistory';\n\nvar factory = _FactoryMaker2.default.getClassFactory(SwitchRequestHistory);\n\nexports.default = factory;","map":{"version":3,"mappings":";;;;;;AA+BA;;;;AACA;;;;;;;;AAhCA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA,IAAMA,+BAA+B,CAArC,C,CAAwC;;AAExC,SAASC,oBAAT,GAAgC;EAC5B,IAAIC,iBAAiB,EAArB,CAD4B,CACH;;EACzB,IAAIC,YAAY,EAAhB,CAF4B,CAER;;EAEpB,SAASC,IAAT,CAAcC,aAAd,EAA6B;IACzB,IAAIA,cAAcC,QAAdD,KAA2BE,wBAAcC,SAA7C,EAAwD;MACpDH,cAAcC,QAAdD,GAAyBA,cAAcI,QAAvCJ;IAEJ;;IAAA,IAAI,CAACH,eAAeG,cAAcI,QAA7BP,CAAL,EAA6C;MACzCA,eAAeG,cAAcI,QAA7BP,IAAyC;QAACQ,SAAS,CAAV;QAAaC,OAAO,CAApB;QAAuBC,UAAU;MAAjC,CAAzCV;IAGJ,CARyB,CAQzB;;;IACA,IAAIW,YAAYR,cAAcC,QAAdD,GAAyBA,cAAcI,QAAvD;IACA,IAAIK,OAAQD,YAAY,CAAZA,GAAiB,CAAjBA,GAAqB,CAAjC;IACA,IAAID,WAAWE,OAAO,CAACD,SAARC,GAAoB,CAAnC;IACA,IAAIC,SAASD,OAAO,CAAPA,GAAW,CAAxB,CAZyB,CAczB;;IACAZ,eAAeG,cAAcI,QAA7BP,EAAuCS,KAAvCT,IAAgDY,IAAhDZ;IACAA,eAAeG,cAAcI,QAA7BP,EAAuCU,QAAvCV,IAAmDU,QAAnDV;IACAA,eAAeG,cAAcI,QAA7BP,EAAuCQ,OAAvCR,IAAkDa,MAAlDb,CAjByB,CAmBzB;;IACAC,UAAUC,IAAVD,CAAe;MAACa,KAAKX,cAAcI,QAApB;MAA8BM,QAAQA,MAAtC;MAA8CD,MAAMA,IAApD;MAA0DF,UAAUA;IAApE,CAAfT,EApByB,CAsBzB;;IACA,IAAKA,UAAUc,MAAVd,GAAmBH,4BAAxB,EAAuD;MACnD,IAAIkB,iBAAiBf,UAAUgB,KAAVhB,EAArB;MACAD,eAAegB,eAAeF,GAA9Bd,EAAmCS,KAAnCT,IAA4CgB,eAAeJ,IAA3DZ;MACAA,eAAegB,eAAeF,GAA9Bd,EAAmCU,QAAnCV,IAA+CgB,eAAeN,QAA9DV;MACAA,eAAegB,eAAeF,GAA9Bd,EAAmCQ,OAAnCR,IAA8CgB,eAAeH,MAA7Db;IAEP;EAED;;EAAA,SAASkB,iBAAT,GAA6B;IACzB,OAAOlB,cAAP;EAGJ;;EAAA,SAASmB,KAAT,GAAiB;IACbnB,iBAAiB,EAAjBA;IACAC,YAAY,EAAZA;EAGJ;;EAAA,OAAO;IACHC,MAAMA,IADH;IAEHgB,mBAAmBA,iBAFhB;IAGHC,OAAOA;EAHJ,CAAP;AAOJpB;;AAAAA,qBAAqBqB,qBAArBrB,GAA6C,sBAA7CA;;AACA,IAAMsB,UAAUC,uBAAaC,eAAbD,CAA6BvB,oBAA7BuB,CAAhB;;kBACeD,O","names":["SWITCH_REQUEST_HISTORY_DEPTH","SwitchRequestHistory","switchRequests","srHistory","push","switchRequest","newValue","SwitchRequest","NO_CHANGE","oldValue","noDrops","drops","dropSize","indexDiff","drop","noDrop","idx","length","srHistoryFirst","shift","getSwitchRequests","reset","__dashjs_factory_name","factory","FactoryMaker","getClassFactory"],"sources":["/home/landsys/react-node-video-streaming/client/node_modules/dashjs/src/streaming/rules/SwitchRequestHistory.js"],"sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport FactoryMaker from '../../core/FactoryMaker';\nimport SwitchRequest from './SwitchRequest';\n\nconst SWITCH_REQUEST_HISTORY_DEPTH = 8; // must be > SwitchHistoryRule SAMPLE_SIZE to enable rule\n\nfunction SwitchRequestHistory() {\n    let switchRequests = []; // running total\n    let srHistory = []; // history of each switch\n\n    function push(switchRequest) {\n        if (switchRequest.newValue === SwitchRequest.NO_CHANGE) {\n            switchRequest.newValue = switchRequest.oldValue;\n        }\n        if (!switchRequests[switchRequest.oldValue]) {\n            switchRequests[switchRequest.oldValue] = {noDrops: 0, drops: 0, dropSize: 0};\n        }\n\n        // Set switch details\n        let indexDiff = switchRequest.newValue - switchRequest.oldValue;\n        let drop = (indexDiff < 0) ? 1 : 0;\n        let dropSize = drop ? -indexDiff : 0;\n        let noDrop = drop ? 0 : 1;\n\n        // Update running totals\n        switchRequests[switchRequest.oldValue].drops += drop;\n        switchRequests[switchRequest.oldValue].dropSize += dropSize;\n        switchRequests[switchRequest.oldValue].noDrops += noDrop;\n\n        // Save to history\n        srHistory.push({idx: switchRequest.oldValue, noDrop: noDrop, drop: drop, dropSize: dropSize});\n\n        // Shift earliest switch off srHistory and readjust to keep depth of running totals constant\n        if ( srHistory.length > SWITCH_REQUEST_HISTORY_DEPTH ) {\n            let srHistoryFirst = srHistory.shift();\n            switchRequests[srHistoryFirst.idx].drops -= srHistoryFirst.drop;\n            switchRequests[srHistoryFirst.idx].dropSize -= srHistoryFirst.dropSize;\n            switchRequests[srHistoryFirst.idx].noDrops -= srHistoryFirst.noDrop;\n        }\n    }\n\n    function getSwitchRequests() {\n        return switchRequests;\n    }\n\n    function reset() {\n        switchRequests = [];\n        srHistory = [];\n    }\n\n    return {\n        push: push,\n        getSwitchRequests: getSwitchRequests,\n        reset: reset\n    };\n}\n\nSwitchRequestHistory.__dashjs_factory_name = 'SwitchRequestHistory';\nconst factory = FactoryMaker.getClassFactory(SwitchRequestHistory);\nexport default factory;\n"]},"metadata":{},"sourceType":"script"}